# プロジェクト概要

Pythonで作成した、ローグライクダンジョンゲームのサンプルコードです。
書籍「[Pythonでつくる ゲーム開発 入門講座](https://amzn.to/3cfIdhz)」のサンプルコードをベースとして、リファクタリング及び、ゲーム内容の調整、リソースの差し替えなどを行っています。

プレイ動画等、概要情報については以下Qiita記事も参照ください。

## Pythonでローグライクゲーム作ってみた
https://qiita.com/beckyJPN/items/e08eb83f3d1e9f468f86

# 環境
- OS：Windows 10
- Python：3.7.4

## 利用ライブラリ
- pygame 1.9.6
- numpy 1.18.4

# 操作説明
## タイトル画面
- [SPACE] - ゲームスタート

## マップ画面
- [矢印キー] - プレイヤーの移動
- [S] - ゲームスピードの調整
- [P] - ポーション利用
- [B] - ボム利用


# プロジェクト解説
## メイン
`main.py` がスタートファイルとなります。
ここで無限ループを回し、SceneとTaskの切り替えながら
ゲームの手続きを勧めていきます。
以下コマンドで実行してください。
```sh
$ python main.py
```

また、ゲームクリアはなく、 `HP` が `0` となり、ゲームオーバーとなるまで
ゲームは続きます。

## シーン
このゲームには以下2つのシーンがあります。
- Title - タイトル画面
- Map - マップ画面

`Scene` クラスの `get_next_scene` 関数が次のシーンのインスタンスを戻すと
シーン切り替えが発生します。

また、以下関数がカッコの中のタイミングで呼ばれます。
基本的に `update` 関数でゲームの手続きを進め、
`draw` 関数で描画手続きを行います。

- start (シーン開始直後)
- update (毎フレーム)
- draw (毎フレーム)
- exit (シーン終了時)

## タスク
シーンの中でさらに細かい状態を示すものがタスクです。
タスクも構造としては、シーンと似ています。

`Task` クラスの `get_next_task` 関数が次のタスクのインスタンスを戻すと
タスク切換えが発生します。

以下関数がカッコの中のタイミングで呼ばれます。
- start (タスク開始直後)
- update (毎フレーム)
- draw (毎フレーム)
- exit (タスク終了時)

## 描画手続き
`Camera` クラスの `add_draw_object` 関数で描画オブジェクトを追加し、
`draw` 関数で追加されたすべてのオブジェクトを表示します。
後で追加されたものほど、前面に表示されます。

座標系は、スクリーンとは別にゲーム内にワールド座標を持ち、
`Camera` の位置する座標から見えるオブジェクトのみがスクリーンに表示されます。

## MAPデータの持ち方
以下の種類は2次元配列データを示す　`Matrix`　クラスとして各座標の情報を持っています。

- floor_map / 床、障害物の情報
- enemy_map / 敵の情報
- treasure_map / 宝箱の情報

また、プレイヤーと階段は個別に座標持ち、 `Matrix` クラスとしては表現されません。

## キャラクタのステータス
`Stats` クラスは敵とプレイヤーのステータスを表現します。
冗長ですが、共通化させるため敵も `POTION` や `BOM` を持つ事となります。
また、ステータスには下限、上限があるため、 `RangeValue` クラスとして
値を表現しています。

# ファイル構造
- main.py - スタートファイル

## game
- game_system / 画面の描画、音楽の再生など、ゲームシステム部分の処理等
- game_info / ゲーム進行中の情報等

## libs
ドメインに関わらない汎用的に利用できるライブラリ郡

## manager
各種処理手続きをまとめて扱うマネージャー郡

## model
各種モデル
- draw_object / 描画するオブジェクト
- effect / エフェクト処理
- event / map上でのイベントや敵等。 プレイヤーもイベントの一種として扱う

## resource
各種リソースデータ

## Scene
- Title - タイトル画面
- Map - マップ画面

## Task
各シーン毎のタスク説明です。
### Title
- initialize / タイトルの準備
- wait_input / キー入力を待ち
- start_effect / 画面切り替え処理
- scene_to_map / マップシーン遷移
### Map
- initizlize / マップの準備
- wait_input / キー入力待ち
- move / 移動処理
- battle / 戦闘処理
- level_up / レベルアップ処理
- get_item / アイテム入手処理
- use_item / アイテム利用処理
- change_floor / フロア切り替え処理
- game_over / ゲームオーバー処理
- scene_to_title / タイトル遷移処理
# Tips
## ゲームバランスの調整
### 戦闘バランス
`Player` と `Enemy` クラスはそれぞれ `battle` 関数を持っているので、
ここの中身を調整することで、戦闘バランスが調節できます。
`Enemy` クラスの `__get_default_stats` 関数で初期パラメータの設定を行っています。

### レベルアップ調整
`Player` クラスの `is_level_up` 関数でレベルアップの確率を求めています。

### アイテム取得

`Enemy` クラスの `get_item` 関数では、敵を倒したときのアイテム取得確率調整ができます。
`TreasureBox` クラスの `__get_item` 関数で、宝箱の中身を調整しています。


## windowsサイズの調整
`main.py` の定数 `__POWER` を調整すると、windowsサイズが切り替わります。

## デバッグ
`debug_manager.py` の `is_debug` を `True` にすると、階層やLevel等を調整してゲームを開始できます。
